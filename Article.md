# Chromeを使いながらディベートするマルチエージェントAI Vtuberシステムを作ってみた
## プロジェクト概要
Chromeを使いながらディベートするマルチエージェントAI Vtuberシステムを作成しました。
２人のAIエージェントがYoutube上で、視聴者を交えてインタラクティブなライブ配信を行います。必要に応じてbrowser_useやthinkモデル等のツールを使用することで正確性の高いレスポンスを得られる他、両者に相反する主張を与えてディベート形式で議論を行わせることで批判的な観点からエージェントのアウトプットを検証できます。また、エージェントにはシステムプロンプトで任意の性格を付与でき、必要に応じて論理性を重視した展開にすることも、エンターテインメントとしてライブ配信を楽しめるような展開にすることも可能です。
## 課題とアプローチ
### 概要
ChatGPTを始めとする高度な対話AIの登場により、私たちはこれまで以上に簡単に知りたい情報を得ることができるようになりました。しかし一方で、これらのAIの返答は必ずしも正確なものとは限らず、所謂ハルシネーションの問題は対話AIの使用における大きな懸念となっています。私たちは、この問題に対して<b>複数のAIエージェントと使用者がインタラクティブにコミュニケーションして正しい情報を模索していく</b>アプローチを提案します。

### 解決を試みる課題
既にハルシネーションは公知の問題であり、これを解決するために多くの努力がなされ、比較的古いモデルと比べると現在のモデルは大きく改善しています。ですが、モデルの信頼性を上げるだけでは常に正しい情報を得られるとは限りません。
<p>
モデルの内部に必要とされる知識を全て取り込むことは現実的ではないため、より高度な情報提供機能を得るためには必然的にインタネットを介して情報を収集するAIエージェントを考えることになるでしょう。しかし、インターネットには不正確な情報が散乱しており、これらを参照した回答は必然的に誤りを含んでしまうことになります。さらには、AIの学習段階で好ましくないデータの混入を防ぐことも現実的には困難でしょう。これらの問題は厳密にはハルシネーションとは異なりますが、ユーザーに誤った情報が渡されるという点では同質の問題と言えます。
<p>
私たちは、どうすれば対話AIの使用者が正確な情報に安定してアクセスできるかについて考え、今回のプロジェクトでこの問題に対する一つの解決策を提案します。

<適当にそれっぽい画像を挿入>
### 私たちの課題へのアプローチ
私たちのアプローチの核心は、<b>AIのみに情報の正確性担保を依存するのではなく、ユーザーとAIがインタラクティブにコミュニケーションを取ることで批判的な観点から情報を精査していくべき</b>というアイデアにあります。
<p>
本質的に、ある情報が正確かどうかを判断するタスクは人間に委ねられています。そして、AIは人類がこれまで築いてきた価値判断の基準を解釈し、それに沿った出力を行うように設計されたものです。しかし、人によって意見の分かれる話題も多くある現実世界において、AIモデルに常に正確な出力を期待することは難しいのではないでしょうか。それよりも、本質的な真偽の決定者である人間がAIと共に情報収集・精査を行い、共に正しい答えを構築していくことが、理想的なアプローチであると私たちは考えました。AIの出力に対して、批判的な観点から再質問を行い、思考を繰り返すことで最終的な出力の信頼性は向上していくでしょう。
<p>
しかし、多くの人にとって常にAIの出力に対して常に批判的な観点を持ち続けることは、それ自体が大きな負担を強いるものになります。そこで、私たちは<b>ユーザーの批判的思考を助けるために、複数のAIエージェントを導入する</b>ことに思い当たりました。
あるエージェントの意見に対して、ある別のエージェントに批判的なコメントを行わせ、議論を促すことで情報の精査を行うとともに、ユーザーに対しても論点を明示的に提示し、情報の精査を行う上での取っ掛かりを提供するのです。
<p>
ここでは、既にユーザーとアシスタントという主従関係は希薄化され、AIエージェントはユーザーのコラボレーターとなり、情報の精査という文脈において対等な関係で効果的にタスクを遂行することが可能になると考えています。

### 今回のプロジェクトで実現されたこと
今回私たちは、プロジェクトをyoutube上で配信されるAIエージェントによるライブという形で構築しました。これは、情報の精査に加わるユーザーは１人に限定されず、寧ろ複数の人間と複数のAIエージェントが一つのチームとしてインタラクティブにコミュニケーションを取りながらタスクを遂行していく形が理想的だと考えたためです。Youtubeは多くの人が日常的に使用しているプラットフォームであり、学校教育の場でも積極的に導入され始めています。そのため、私たちのアアイデアYoutube上で実現することで、よりスムーズなコミュニケーションが実現されると期待しています。
<p>
さらに、私たちは一緒にタスクを遂行するコラボレーターとして、AIエージェントが単なる無機質なコンソール上のものではなくて、あたかも一つの人格を持ったバーチャルなキャラクターのように感じられるものであるべきだと考えました。将来的には人間がAIコラボレーターと仕事等で多くの時間を共にすることになると私たちは信じており、その際にコンソール上の文字列と長時間向き合うのは苦痛以外のなにものでも無いでしょう。これは、私たちがYoutubeでのライブ配信という形を選択したもう一つの理由です。AIエージェントはその対話上の応答以外に、コンテキストに応じたエモーションを出力し、それはUnity上で作成されたアバターに連携されます。さらに、リップシンクの技術を用いることでAIエージェントの発話に応じた口の動きを実現しました。これらの技術的な工夫によって、ユーザーはあたかもオンラインで人と対話しているように感じれられることが期待できます。
<p>
今回のプロジェクトでは、実際に複数のエージェントに対話を行わせることで、批判的な観点に基づいて情報を精査していくことが可能であることを示すために、２体のエージェントによるディベートをデモンストレーションとして実装しました。ユーザーはエージェントたちに議論のテーマを提供し、エージェントらがそれに対して議論を交わす様子を確認することができます。現段階ではユーザーはこの議論に直接的に参加することはできませんが、ユーザーはライブ配信のコメントとしてアクションを起こすことができ、それに基づいてディベートの勝敗が決定されます。


<アイディアの創造性と独創性をそれとなく強調>

<適当にそれっぽい画像を挿入>
## システムの概要
![architecture](images/architecture.png)

今回作成したシステムの構成は上の図のようになっています。
<p>
各AIエージェントはlanggraphを用いて実装されています。推論はGemini API in Vertex AIを介して行われています。出力のクオリティを向上するためにエージェントにはThinkとWebSearchという２つのツールが与えられ、状況に応じてエージェントが使用するツールを自ら選択し、活用します。エージェントの発言に一貫性を持たせ、論理的に整合性の取れた議論を行わせるために、エージェントの毎回の発言内容は埋め込みモデルによって圧縮され、chromadbに保管され、新しい応答を生成する際に参照されます。
<br>
通常の応答及びツールの選択にはgemini-2.0-flash-expを用いています。
<br>
Thinkはより論理的な応答を可能にするためのツールで、gemini-2.0-flash-thinking-exp-1219を用いています。
<br>
WebSearchではbrowser_useを用いてエージェントにchromeを操作させ、インターネット上で情報収集を行います。
<br>
さらに、ディベートの勝敗判定のために、視聴者からのコメントの文埋め込みを取得し、それをUMAPを用いて２次元に圧縮しています。ここから、各エージェントの主張と各コメントとのユークリッド距離を算出し、より多くのコメントが支持していると推定される主張を優勢と判定しています。
<br>
これらのエージェントに関する処理は、GCE上で実行されます。これは、文埋め込みを作成するに当たって多くのGPUによる計算能力が必要となるためです。この部分をクラウド上で実行することにより、スペックの低いPCを使用するユーザーでも問題なくこのシステムを利用できます。一方、後述するライブ配信を実行するツール群はローカルで動作させることによりユーザビリティの向上が見込めるため、クラウド上で実行するすることを選択しませんでした。
<p>
視聴者のコメントはYoutubeDataAPIを用いて取得され、コンテキストに応じた前処理を施した上でエージェントに入力されます。
<br>
エージェントの発話内容はWebSocket通信によりUnityアプリケーションに送信されます。Unityではエージェントの状態に応じて対応するアバターにモーションを付与し、エージェントの発話に対して音声合成エンジンを用いて声を追加します。また、音声合成の際にはリップシンクの技術を用いてアバターが発話しているように演出を行っています。
<br>
UnityアプリケーションにはWebRTCを用いてクラウド上のエージェントが操作しているブラウザとコメントの埋め込みプロットが送信され、Unity側でこれが画面内に配置されます。
<br>
最終的に、このUnityアプリケーションの画面をOBSstudioでキャプチャすることで配信が実行されます。

<システム全体の概要について述べる. Gemini API in Vertex AIとGCEを利用していることはそれとなく強調する>

<システムの拡張性，運用可能性，費用対効果について強調する>

<こまごまとした実装というよりは，ツールを効果的に活用している事を強調したほうがよさそう>

<文字数に余裕があれば，個々の要素に着目して説明を行う>
## 

## 実際の動作
<3分以内のデモ動画を埋め込む>

<何が起きているかの簡単な説明>

## まとめ
今回のシステムではマルチエージェントによるディベートを通じて、複数のエージェントが適切にブラウジングや深い思考を駆使して議論を行うことで、批判的な観点からエージェントの発言内容を検証し、情報収集の信頼性向上に役立てることができることをデモンストレーションしました。今後よりAIエージェントが発展していくにつれて、エージェントと人が相互にコミュニケーションの取り方が重要になってくるでしょう。今回のシステムではyoutubeというプラットフォーム上でユーザーフレンドリーなアバターを使用することでAIエージェントと人のコミュニケーションの一つの在り方を示すことができたのではないかと考えています。

## コード
- クラウド側

https://github.com/ONIXION/ai_youtuber.git

- Unity側

https://github.com/ONIXION/ai_youtuber_unity.git